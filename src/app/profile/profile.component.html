<div class="profile-container">

  <div *ngIf="isLoading" class="loading-box">
    ƒêang t·∫£i th√¥ng tin...
  </div>

  <div *ngIf="!isLoading && !profileData" class="error-box">
    <h3>Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng "{{ targetUsername }}"</h3>
    <button routerLink="/home" class="btn-back">Quay v·ªÅ trang ch·ªß</button>
  </div>

  <div *ngIf="!isLoading && profileData" class="profile-content">

    <div class="profile-header">
      
      <div class="avatar-section">
        <img [src]="profileData.avatarUrl || 'assets/default-avatar.png'" alt="Avatar" class="profile-avatar">
      </div>

      <div class="info-section">

        <div class="name-row">
          
          <h2 class="username">{{ profileData.fullName }}</h2>
          <span style="color: #666; font-size: 0.9rem; margin-left: 10px;">(@{{ profileData.username }})</span>

          <div class="actions">
            <ng-container *ngIf="isMyProfile; else otherProfileActions">
              <button class="btn btn-secondary" (click)="openEditModal()">‚úèÔ∏è Ch·ªânh s·ª≠a trang c√° nh√¢n</button>
            </ng-container>

            <ng-template #otherProfileActions>
              <button *ngIf="!isFollowing" class="btn btn-primary" (click)="toggleFollow()">Follow</button>
              <button *ngIf="isFollowing" class="btn btn-outline" (click)="toggleFollow()">ƒêang Follow</button>
              <button class="btn btn-secondary">Nh·∫Øn tin</button>
            </ng-template>
          </div>

        </div>

        <div class="stats-row">
          <span><strong>{{ userPosts.length }}</strong> b√†i vi·∫øt</span>
          
          <span>
            <strong>{{ profileData.followerCount || 0 }}</strong> ng∆∞·ªùi theo d√µi
          </span>

          <span>
            <strong>{{ profileData.followingCount || 0 }}</strong> ƒëang theo d√µi
          </span>
        </div>

        <div class="bio-row">
          <p>{{ profileData.bio || 'Ng∆∞·ªùi d√πng n√†y ch∆∞a vi·∫øt gi·ªõi thi·ªáu.' }}</p>
        </div>
      </div>
    </div>

    <hr class="divider">

    <div class="posts-grid">
      <div *ngIf="userPosts.length === 0" class="no-posts">
        <div class="icon">üì∑</div>
        <p>Ch∆∞a c√≥ b√†i vi·∫øt n√†o.</p>
      </div>

      <div *ngFor="let post of userPosts" class="post-item">
        <div class="post-card-simple">
          <div class="post-meta">{{ post.createdAt | date:'shortDate' }}</div>
          <div class="post-text">{{ post.content }}</div>
          <div class="post-footer">‚ù§Ô∏è {{ post.likeCount }} ‚Ä¢ üí¨ {{ post.commentCount }}</div>
        </div>
      </div>
    </div>

  </div>
</div>

<div class="modal-overlay" *ngIf="showEditModal">
  <div class="modal-content">
    <h3>Ch·ªânh s·ª≠a trang c√° nh√¢n</h3>

    <div class="form-group" style="text-align: center;">
        <label>·∫¢nh ƒë·∫°i di·ªán</label>
        <img [src]="previewAvatar || 'assets/default-avatar.png'" 
             style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; border: 1px solid #ddd;">
        <br>
        <input type="file" (change)="onFileSelected($event)" accept="image/*">
    </div>

    <div class="form-group">
      <label>T√™n ƒëƒÉng nh·∫≠p (Kh√¥ng th·ªÉ ƒë·ªïi)</label>
      <input type="text" [value]="profileData.username" disabled class="input-disabled">
    </div>

    <div class="form-group">
      <label>T√™n hi·ªÉn th·ªã (Fullname)</label>
      <input type="text" [(ngModel)]="editData.fullName" placeholder="Nh·∫≠p t√™n hi·ªÉn th·ªã...">
    </div>

    <div class="form-group">
      <label>Ti·ªÉu s·ª≠ (Bio)</label>
      <textarea [(ngModel)]="editData.bio" rows="3" placeholder="Gi·ªõi thi·ªáu b·∫£n th√¢n..."></textarea>
    </div>

    <div class="modal-actions">
      <button class="btn-cancel" (click)="closeEditModal()">H·ªßy</button>
      <button class="btn-save" (click)="saveProfile()">L∆∞u thay ƒë·ªïi</button>
    </div>
  </div>
</div>